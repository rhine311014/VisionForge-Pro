# VisionForge Pro - 设计文档总览

## 📚 文档导航

欢迎来到 VisionForge Pro 的设计文档库！本项目采用**双模式设计**（简单模式 + 专业模式），旨在打造一款既易用又专业的工业视觉检测平台。

---

## 📋 文档清单

### 架构设计

📄 **[01-整体架构设计.md](architecture/01-整体架构设计.md)**
- 六层架构详解（应用层、业务逻辑层、算法服务层、HAL、基础设施层、数据持久层）
- 双模式UI架构
- 性能优化策略
- 开发路线图（9个月MVP）

**关键内容**：
- ✅ 架构分层清晰，职责明确
- ✅ 简单模式 vs 专业模式对比
- ✅ 性能目标修正为"典型场景<10ms"
- ✅ 非功能性需求（性能、稳定性、兼容性）

---

### 核心设计

📄 **[02-核心类图设计.md](design/02-核心类图设计.md)**
- UI层类图（MainWindow、SimpleModeWidget、ProfessionalModeWidget）
- 业务逻辑层类图（Recipe、RecipeManager、TaskScheduler）
- 算法服务层类图（VisionTool基类及子类、ToolFactory）
- HAL层类图（ICamera、ILight、IPLC）
- 基础设施层类图（ImageData、Logger、ConfigManager）

**关键内容**：
- ✅ 完整的类继承关系图
- ✅ 详细的接口定义（带代码示例）
- ✅ 设计模式应用（单例、工厂、策略、PIMPL等）
- ✅ 依赖关系清晰可追溯

---

📄 **[03-交互流程设计.md](design/03-交互流程设计.md)**
- 应用启动流程（欢迎向导）
- 简单模式核心流程（添加步骤、参数调整、ROI示教、运行检测）
- 专业模式核心流程（模式切换、多任务管理、调试模式）
- 配方管理流程（保存、打开、版本对比）
- 异常处理流程（相机连接失败、检测超时、参数非法）

**关键内容**：
- ✅ ASCII流程图清晰易懂
- ✅ 5分钟上手的详细步骤
- ✅ 所见即所得的参数调整流程
- ✅ 完善的异常处理机制

---

📄 **[04-数据结构设计.md](design/04-数据结构设计.md)**
- 配方(Recipe)数据结构（JSON格式 + C++结构体）
- 检测结果(InspectionResult)数据结构
- 工具参数数据结构（FindCircleParams、AIDetectionParams等）
- 图像数据结构（ImageData、ImageMemoryPool）
- 数据库设计（SQLite Schema）

**关键内容**：
- ✅ JSON序列化格式完整定义
- ✅ 零拷贝图像数据设计
- ✅ 对象池模式提升性能
- ✅ 数据验证与约束规则
- ✅ 版本兼容与迁移策略

---

📄 **[05-UI组件详细设计.md](design/05-UI组件详细设计.md)**
- 简单模式UI组件（StepListWidget、ImageDisplayWidget、SimpleParamPanel）
- 专业模式UI组件（ProjectTreeWidget、ToolboxWidget、PropertyPanel）
- 通用UI组件（状态栏、工具栏）
- 主题与样式（浅色/深色主题、全局CSS）
- 响应式设计（DPI缩放、不同分辨率适配）

**关键内容**：
- ✅ ASCII界面原型图
- ✅ 完整的Qt类设计（带代码）
- ✅ 自定义绘制实现（QStyledItemDelegate）
- ✅ 无障碍设计（快捷键、工具提示）

---

## 🎯 核心设计决策

### 1. 双模式设计

```
简单模式 (80%用户)          专业模式 (20%用户)
├─ 步骤列表式               ├─ 三栏布局
├─ 核心参数展示             ├─ 完整参数面板
├─ 图标化工具选择           ├─ 多任务管理
└─ 5分钟上手目标           └─ 高级调试功能
```

**决策理由**：满足不同用户群体需求，避免"功能丰富但难用"的陷阱。

---

### 2. 性能目标修正

```diff
- 原目标: <1ms检测时间
+ 修正后: 典型场景<10ms，简单场景<3ms
```

**决策理由**：基于Opus深度分析，<1ms在工业场景不现实，修正为可实现的目标。

---

### 3. 放弃Node-RED式流程画布

```diff
- 原方案: 节点连线式流程编辑器
+ 最终方案: 步骤列表式（简单模式）+ 灵活布局（专业模式）
```

**决策理由**：
- ✅ 符合工业用户线性思维习惯
- ✅ 调试效率更高（一眼看完所有步骤）
- ✅ 触摸屏友好（大按钮、大滑块）
- ✅ 与Keyence用户习惯一致

---

### 4. 六层架构

```
应用层 → 业务逻辑层 → 算法服务层 → HAL → 基础设施层 → 数据层
```

**决策理由**：
- ✅ 分层清晰，职责单一
- ✅ 易于测试和维护
- ✅ 支持未来扩展（插件系统、云端协同）

---

## 📊 设计亮点

### ✨ 易用性设计

| 特性 | 实现方式 |
|------|---------|
| 5分钟上手 | 欢迎向导 + 图标化工具选择 + 滑块参数调整 |
| 所见即所得 | 参数改变立即预览图像结果 |
| ROI示教 | 鼠标框选自动生成参数 |
| 错误提示 | 包含可操作建议，不只显示错误码 |

### ⚡ 性能优化

| 优化点 | 技术方案 | 预期提升 |
|--------|---------|---------|
| 图像传输 | 零拷贝 + 智能指针 | 避免内存拷贝开销 |
| 内存管理 | 对象池预分配 | 减少malloc/free |
| GPU加速 | TensorRT + OpenCL | AI推理提升10-50x |
| 多线程 | 流水线并行处理 | 提升吞吐量 |

### 🔒 稳定性保障

| 机制 | 说明 |
|------|------|
| 异常处理 | 每个关键操作都有try-catch + 用户友好提示 |
| 参数验证 | 输入框实时验证 + 非法值高亮 |
| 故障诊断 | 硬件自检工具 + 详细日志 |
| 配方版本控制 | Git-like版本管理 + 一键回滚 |

---

## 🛠️ 技术栈总结

| 层级 | 技术选型 |
|------|---------|
| UI框架 | **Qt 6.5 LTS** |
| 传统CV | **OpenCV 4.x** |
| AI推理 | **ONNX Runtime + TensorRT** |
| 相机接口 | **GenICam** |
| 数据库 | **SQLite** |
| 序列化 | **JSON (QJsonDocument)** |
| 日志 | **Qt日志系统** |

---

## 📈 开发计划

### MVP (9个月)

```
M1 (1-3月): 技术验证
├─ 基础框架
├─ HAL层
└─ 单相机Demo

M2 (4-6月): Alpha版
├─ 简单模式UI
├─ 8-10个核心工具
└─ 业务逻辑层

M3 (7-9月): Beta版
├─ 专业模式UI
├─ 故障诊断系统
├─ 1个行业模板
└─ 种子客户试用
```

### Phase 2 (+6个月)

- 多相机同步
- TensorRT集成
- 3个行业模板
- 高级统计分析

### Phase 3 (+6个月)

- 插件SDK
- 插件市场
- 云端协同

---

## 📖 如何使用本文档

### 面向不同角色

| 角色 | 推荐阅读顺序 |
|------|-------------|
| **项目经理** | 01 整体架构 → 03 交互流程 → 开发计划 |
| **架构师** | 01 整体架构 → 02 类图设计 → 04 数据结构 |
| **前端开发** | 05 UI组件设计 → 03 交互流程 → 02 类图(UI层) |
| **后端开发** | 02 类图设计 → 04 数据结构 → 01 架构(算法层/HAL) |
| **测试工程师** | 03 交互流程 → 01 架构(非功能性需求) |

---

## 🔧 设计工具

本文档使用以下工具辅助设计：

- **流程图**: ASCII Art
- **类图**: C++伪代码 + 文字描述
- **界面原型**: ASCII Art + 文字说明
- **数据格式**: JSON示例 + C++结构体

**注**：正式开发时可使用以下工具：
- UML类图：PlantUML / draw.io
- 界面原型：Qt Designer / Figma
- 流程图：draw.io / Visio

---

## 📝 文档维护

### 更新记录

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2025-12-14 | v1.0 | 初始版本，完成所有5份设计文档 | VisionForge Team |

### 待完善项

- [ ] 使用PlantUML重绘类图（更直观）
- [ ] 补充性能测试基准数据
- [ ] 添加插件开发SDK文档（Phase 2）
- [ ] 补充国际化方案（多语言支持）

---

## 🤝 贡献指南

如需修改设计文档，请遵循以下流程：

1. **提出变更请求**：说明变更原因和影响范围
2. **团队评审**：架构师/技术负责人审批
3. **更新文档**：修改对应章节并更新版本号
4. **同步代码**：如已开始编码，同步更新代码注释

---

## 📧 联系方式

- **技术负责人**: [待填写]
- **项目管理**: [待填写]
- **文档维护**: VisionForge Team

---

**VisionForge Pro** - 锻造极致视觉体验 🔧✨

---

*最后更新: 2025-12-14*
