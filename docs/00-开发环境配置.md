# VisionForge Pro - 开发环境配置指南

## 文档信息

- **文档版本**: v1.0
- **创建日期**: 2025-12-14
- **适用平台**: Windows 10/11 x64

---

## 1. 必备软件清单

### 1.1 开发工具

| 软件 | 版本 | 安装路径 | 用途 |
|------|------|---------|------|
| **CMake** | 3.20+ | `D:\Program Files\CMake` | 构建系统 |
| **Visual Studio** | 2022 Professional | `F:\Program Files\Microsoft Visual Studio\2022\Professional` | C++编译器和IDE |
| **Git** | 2.40+ | `C:\Program Files\Git` | 版本控制 |

**Visual Studio 必需组件**：
- ✅ 使用C++的桌面开发
- ✅ Windows 10/11 SDK (10.0.19041.0+)
- ✅ MSVC v143 (Visual Studio 2022 C++)
- ✅ C++ CMake工具

---

### 1.2 核心依赖库

| 库名 | 版本 | 安装路径 | 许可证 | 说明 |
|------|------|---------|--------|------|
| **Qt** | 6.9.3 | `F:\Qt\6.9.3` | LGPL/商业 | UI框架 |
| **OpenCV** | 4.x | `F:\Program Files\OPENCV` | Apache 2.0 | 传统CV算法 |
| **Halcon** | 24.11 Progress | `F:\Halcon\HALCON-24.11-Progress-Steady` | 商业许可 | 高级视觉算法（可选） |

**Qt 必需模块**：
- Qt6::Core
- Qt6::Widgets
- Qt6::Gui
- Qt6::Network
- Qt6::Sql
- Qt6::Xml

---

### 1.3 AI推理库（可选）

| 库名 | 推荐版本 | 下载地址 | 说明 |
|------|---------|---------|------|
| **ONNX Runtime** | 1.16+ | https://github.com/microsoft/onnxruntime/releases | CPU/GPU推理 |
| **TensorRT** | 8.6+ | https://developer.nvidia.com/tensorrt | NVIDIA GPU加速 |
| **CUDA Toolkit** | 12.0+ | https://developer.nvidia.com/cuda-downloads | GPU计算平台 |

**注**：如果不使用AI功能，可暂时跳过此部分。

---

## 2. 环境变量配置

### 2.1 系统环境变量

添加以下路径到 `PATH` 环境变量：

```batch
# CMake
D:\Program Files\CMake\bin

# Qt
F:\Qt\6.9.3\msvc2019_64\bin

# OpenCV
F:\Program Files\OPENCV\build\x64\vc16\bin

# Halcon (可选)
F:\Halcon\HALCON-24.11-Progress-Steady\bin\x64-win64

# Git
C:\Program Files\Git\cmd
```

### 2.2 CMake环境变量

创建以下环境变量：

```batch
# Qt路径
CMAKE_PREFIX_PATH=F:\Qt\6.9.3\msvc2019_64

# OpenCV路径
OpenCV_DIR=F:\Program Files\OPENCV\build

# Halcon路径（可选）
HALCONROOT=F:\Halcon\HALCON-24.11-Progress-Steady
```

### 2.3 验证环境变量

打开命令提示符，执行以下命令验证：

```batch
# 验证CMake
cmake --version
# 应显示: cmake version 3.x.x

# 验证Git
git --version
# 应显示: git version 2.x.x

# 验证Qt
qmake --version
# 应显示: QMake version 3.x Using Qt version 6.9.3

# 验证MSVC编译器
cl
# 应显示: Microsoft (R) C/C++ 优化编译器版本 19.xx
```

---

## 3. 项目依赖库详细配置

### 3.1 Qt 6.9.3 配置

#### 安装位置
```
F:\Qt\6.9.3\
├── msvc2019_64\              (MSVC 2019编译的Qt库)
│   ├── bin\
│   ├── lib\
│   ├── include\
│   └── plugins\
├── Src\                      (Qt源码，可选)
└── Tools\                    (Qt Creator等工具)
```

#### CMake查找路径
```cmake
set(CMAKE_PREFIX_PATH "F:/Qt/6.9.3/msvc2019_64")
find_package(Qt6 REQUIRED COMPONENTS Core Widgets Gui Network Sql Xml)
```

#### 注意事项
- ⚠️ 如果使用Qt 6.9.3但环境中Qt路径是`msvc2022_64`，需要重新安装或切换
- ✅ 建议使用MSVC 2019或2022编译的Qt版本

---

### 3.2 OpenCV 4.x 配置

#### 推荐版本
- OpenCV 4.8.0 或 4.9.0 (稳定版)

#### 安装位置
```
F:\Program Files\OPENCV\
├── build\
│   ├── x64\
│   │   └── vc16\              (Visual Studio 2019)
│   │       ├── bin\           (DLL文件)
│   │       └── lib\           (LIB文件)
│   └── include\               (头文件)
└── sources\                   (源码，可选)
```

#### CMake查找路径
```cmake
set(OpenCV_DIR "F:/Program Files/OPENCV/build")
find_package(OpenCV REQUIRED)
```

#### 所需模块
```cmake
# 必需模块
opencv_core
opencv_imgproc
opencv_imgcodecs
opencv_highgui
opencv_videoio

# 可选模块
opencv_features2d
opencv_calib3d
opencv_objdetect
```

---

### 3.3 Halcon 24.11 配置（可选）

#### 安装位置
```
F:\Halcon\HALCON-24.11-Progress-Steady\
├── bin\
│   └── x64-win64\             (DLL和工具)
├── lib\
│   └── x64-win64\             (LIB文件)
└── include\
    └── halconcpp\             (C++ API头文件)
```

#### CMake查找路径
```cmake
set(HALCONROOT "F:/Halcon/HALCON-24.11-Progress-Steady")
find_package(Halcon REQUIRED)
```

#### 许可证配置
Halcon需要许可证文件，通常位于：
```
F:\Halcon\HALCON-24.11-Progress-Steady\license\license.dat
```

**注意**：
- ⚠️ Halcon是商业软件，需要购买许可证
- ⚠️ 开发阶段可使用试用版（功能有限制）
- ✅ 建议：MVP阶段暂不依赖Halcon，使用OpenCV替代

---

### 3.4 ONNX Runtime 配置（可选）

#### 推荐版本
- ONNX Runtime 1.16.3 (GPU版)

#### 下载链接
```
https://github.com/microsoft/onnxruntime/releases/download/v1.16.3/onnxruntime-win-x64-gpu-1.16.3.zip
```

#### 安装位置（建议）
```
F:\Program Files\onnxruntime\
├── include\                   (头文件)
├── lib\                       (静态/动态库)
└── bin\                       (DLL文件)
```

#### CMake查找路径
```cmake
set(ONNXRUNTIME_DIR "F:/Program Files/onnxruntime")
find_package(onnxruntime REQUIRED)
```

---

### 3.5 CUDA & TensorRT 配置（可选）

**仅在需要GPU加速时安装**

#### CUDA Toolkit
- 版本：CUDA 12.0+
- 下载：https://developer.nvidia.com/cuda-downloads
- 安装位置：`C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.0`

#### TensorRT
- 版本：TensorRT 8.6.1
- 下载：https://developer.nvidia.com/tensorrt
- 安装位置：`C:\Program Files\NVIDIA\TensorRT-8.6.1`

#### CMake查找路径
```cmake
find_package(CUDA REQUIRED)
set(TensorRT_DIR "C:/Program Files/NVIDIA/TensorRT-8.6.1")
```

---

## 4. 快速配置脚本

### 4.1 Windows批处理脚本

创建 `setup_env.bat` 文件：

```batch
@echo off
echo ========================================
echo VisionForge Pro - 环境配置脚本
echo ========================================

REM 设置环境变量
setx CMAKE_PREFIX_PATH "F:\Qt\6.9.3\msvc2019_64"
setx OpenCV_DIR "F:\Program Files\OPENCV\build"
setx HALCONROOT "F:\Halcon\HALCON-24.11-Progress-Steady"

REM 添加到PATH
setx PATH "%PATH%;D:\Program Files\CMake\bin"
setx PATH "%PATH%;F:\Qt\6.9.3\msvc2019_64\bin"
setx PATH "%PATH%;F:\Program Files\OPENCV\build\x64\vc16\bin"

echo.
echo 环境变量配置完成！
echo 请重启命令提示符以使更改生效。
echo.
pause
```

### 4.2 验证脚本

创建 `verify_env.bat` 文件：

```batch
@echo off
echo ========================================
echo 验证开发环境
echo ========================================
echo.

echo [1/5] 检查CMake...
cmake --version
if %errorlevel% neq 0 (
    echo [错误] CMake未安装或未配置PATH
) else (
    echo [成功] CMake已安装
)
echo.

echo [2/5] 检查Git...
git --version
if %errorlevel% neq 0 (
    echo [错误] Git未安装或未配置PATH
) else (
    echo [成功] Git已安装
)
echo.

echo [3/5] 检查Qt...
qmake --version
if %errorlevel% neq 0 (
    echo [错误] Qt未安装或未配置PATH
) else (
    echo [成功] Qt已安装
)
echo.

echo [4/5] 检查MSVC编译器...
where cl >nul 2>&1
if %errorlevel% neq 0 (
    echo [错误] 请在"VS 2022开发人员命令提示符"中运行此脚本
) else (
    echo [成功] MSVC编译器可用
)
echo.

echo [5/5] 检查OpenCV...
if exist "F:\Program Files\OPENCV\build\include\opencv2\opencv.hpp" (
    echo [成功] OpenCV头文件存在
) else (
    echo [错误] OpenCV未正确安装
)
echo.

echo ========================================
echo 验证完成！
echo ========================================
pause
```

---

## 5. Visual Studio 配置

### 5.1 打开项目

使用Visual Studio 2022打开项目的两种方式：

#### 方式1：通过CMake
```batch
# 在项目根目录执行
mkdir build
cd build
cmake .. -G "Visual Studio 17 2022" -A x64
start VisionForge.sln
```

#### 方式2：直接打开文件夹
```
文件 → 打开 → 文件夹 → 选择项目根目录
```
Visual Studio会自动识别CMakeLists.txt并配置项目。

### 5.2 配置构建类型

在Visual Studio中：
```
生成 → 配置管理器 → 活动解决方案配置:
- Debug (调试版本，包含符号信息)
- Release (发布版本，优化性能)
- RelWithDebInfo (带调试信息的发布版)
```

### 5.3 调试器配置

在 `launch.vs.json` 中配置调试器：

```json
{
  "version": "0.2.1",
  "defaults": {},
  "configurations": [
    {
      "type": "default",
      "project": "CMakeLists.txt",
      "projectTarget": "VisionForge.exe",
      "name": "VisionForge.exe (调试)",
      "currentDir": "${workspaceRoot}",
      "env": {
        "PATH": "F:\\Qt\\6.9.3\\msvc2019_64\\bin;${env:PATH}"
      }
    }
  ]
}
```

---

## 6. 常见问题排查

### Q1: CMake找不到Qt

**错误信息**：
```
CMake Error: Could not find a package configuration file provided by "Qt6"
```

**解决方法**：
```batch
# 设置CMAKE_PREFIX_PATH环境变量
set CMAKE_PREFIX_PATH=F:\Qt\6.9.3\msvc2019_64

# 或在CMakeLists.txt中指定
set(CMAKE_PREFIX_PATH "F:/Qt/6.9.3/msvc2019_64")
```

---

### Q2: 运行时找不到Qt DLL

**错误信息**：
```
无法启动此程序，因为计算机中丢失 Qt6Core.dll
```

**解决方法**：
```batch
# 方法1：添加Qt bin目录到PATH
set PATH=%PATH%;F:\Qt\6.9.3\msvc2019_64\bin

# 方法2：使用windeployqt部署DLL（发布时）
windeployqt.exe --release build\Release\VisionForge.exe
```

---

### Q3: OpenCV链接错误

**错误信息**：
```
LNK2019: 无法解析的外部符号 "cv::Mat::..."
```

**解决方法**：
```cmake
# 检查OpenCV版本匹配
find_package(OpenCV 4 REQUIRED)

# 确保链接了正确的库
target_link_libraries(YourTarget
    opencv_core
    opencv_imgproc
    opencv_highgui
)
```

---

### Q4: Halcon许可证错误

**错误信息**：
```
No valid HALCON license found
```

**解决方法**：
1. 检查许可证文件位置：
   ```
   F:\Halcon\HALCON-24.11-Progress-Steady\license\license.dat
   ```
2. 设置环境变量：
   ```batch
   setx HALCONROOT "F:\Halcon\HALCON-24.11-Progress-Steady"
   ```
3. 重启应用程序

---

### Q5: Git中文乱码

**问题**：Git输出中文显示为乱码

**解决方法**：
```batch
# 配置Git使用UTF-8编码
git config --global core.quotepath false
git config --global gui.encoding utf-8
git config --global i18n.commit.encoding utf-8
git config --global i18n.logoutputencoding utf-8
```

---

## 7. 推荐的IDE配置

### 7.1 Visual Studio Code（备选）

如果使用VSCode进行开发：

#### 安装扩展
- C/C++ (Microsoft)
- CMake Tools
- Qt tools
- GitLens

#### 配置文件 `.vscode/settings.json`
```json
{
  "cmake.configureSettings": {
    "CMAKE_PREFIX_PATH": "F:/Qt/6.9.3/msvc2019_64",
    "OpenCV_DIR": "F:/Program Files/OPENCV/build"
  },
  "cmake.generator": "Visual Studio 17 2022",
  "cmake.platform": "x64",
  "files.associations": {
    "*.h": "cpp",
    "*.cpp": "cpp",
    "*.qml": "qml"
  }
}
```

---

## 8. 版本兼容性矩阵

| 组件 | 最低版本 | 推荐版本 | 最高测试版本 |
|------|---------|---------|-------------|
| Windows | 10 (1809) | 10/11 | 11 (23H2) |
| Visual Studio | 2019 16.11 | 2022 17.8 | 2022 17.11 |
| CMake | 3.20 | 3.28+ | 3.30 |
| Qt | 6.2 | 6.9.3 | 6.9.3 |
| OpenCV | 4.5 | 4.8/4.9 | 4.10 |
| Halcon | 20.11 | 24.11 | 24.11 |
| MSVC | 19.28 | 19.38+ | 19.41 |

---

## 9. 构建性能优化

### 9.1 启用多核编译

在Visual Studio中：
```
工具 → 选项 → 项目和解决方案 → 生成和运行
→ 最大并行项目生成数: [CPU核心数]
→ MSBuild 项目生成输出详细信息: 最少
```

或在CMakeLists.txt中：
```cmake
# 启用多核编译
if(MSVC)
    add_compile_options(/MP)
endif()
```

### 9.2 使用预编译头

```cmake
target_precompile_headers(VisionForge PRIVATE
    <QtWidgets>
    <opencv2/opencv.hpp>
)
```

---

## 10. 下一步

环境配置完成后，执行以下步骤：

1. ✅ 运行 `verify_env.bat` 验证环境
2. ✅ 克隆或初始化Git仓库
3. ✅ 使用CMake生成项目文件
4. ✅ 在Visual Studio中打开并编译
5. ✅ 运行单元测试验证构建成功

---

**文档状态**: ✅ 已完成
**维护者**: VisionForge Team
**最后更新**: 2025-12-14
